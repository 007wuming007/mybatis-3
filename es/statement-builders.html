<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia at 15-feb-2013
 | Rendered using Apache Maven Fluido Skin 1.3.0
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="es" lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="author" content="The MyBatis Team" />
    <meta name="Date-Revision-yyyymmdd" content="20130215" />
    <meta http-equiv="Content-Language" content="es" />
    <title>MyBatis - 
    MyBatis 3 | Statement Builders</title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-1.3.0.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />

      
    <script type="text/javascript" src="./js/apache-maven-fluido-1.3.0.min.js"></script>

    
            </head>
        <body class="topBarDisabled">
          
        
    
        <div class="container-fluid">
          <div id="banner">
        <div class="pull-left">
                                                  <a href="index.html" id="bannerLeft" title="MyBatis logo">
                                                                                                <img src="../../images/logo.png"  alt="MyBatis logo"/>
                </a>
                      </div>
        <div class="pull-right">  </div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
                
                    
                  <li id="publishDate">Publicado el: 15 febrero 2013</li>
                  <li class="divider">|</li> <li id="projectVersion">Versión: 3.2.0-SNAPSHOT</li>
                      
                
                    
      
                            </ul>
      </div>

            
      <div class="row-fluid">
        <div id="leftColumn" class="span3">
          <div class="well sidebar-nav">
                
                    
                <ul class="nav nav-list">
                    <li class="nav-header">Manual de Referencia</li>
                                
      <li>
    
                          <a href="index.html" title="Introducción">
          <i class="none"></i>
        Introducción</a>
            </li>
                  
      <li>
    
                          <a href="getting-started.html" title="Primeros pasos">
          <i class="none"></i>
        Primeros pasos</a>
            </li>
                                                                                                                                                                                                                    
      <li>
    
                          <a href="configuration.html" title="Configuración">
          <i class="icon-chevron-right"></i>
        Configuración</a>
                  </li>
                                                                                                                                                              
      <li>
    
                          <a href="sqlmap-xml.html" title="Ficheros XML de mapeo">
          <i class="icon-chevron-right"></i>
        Ficheros XML de mapeo</a>
                  </li>
                  
      <li>
    
                          <a href="dynamic-sql.html" title="SQL dinámico">
          <i class="none"></i>
        SQL dinámico</a>
            </li>
                                                                                      
      <li>
    
                          <a href="java-api.html" title="Java API">
          <i class="icon-chevron-right"></i>
        Java API</a>
                  </li>
                                                                                          
      <li class="active">
    
            <a href="#"><i class="icon-chevron-down"></i>Builders de sentencias</a>
                  <ul class="nav nav-list">
                      
      <li>
    
                          <a href="statement-builders.html#SelectBuilder" title="SelectBuilder">
          <i class="none"></i>
        SelectBuilder</a>
            </li>
                      
      <li>
    
                          <a href="statement-builders.html#SqlBuilder" title="SqlBuilder">
          <i class="none"></i>
        SqlBuilder</a>
            </li>
              </ul>
        </li>
                  
      <li>
    
                          <a href="logging.html" title="Logging">
          <i class="none"></i>
        Logging</a>
            </li>
                              <li class="nav-header">Documentación del proyecto</li>
                                                                                                                                                                                                                                                                                        
      <li>
    
                          <a href="project-info.html" title="Información del proyecto">
          <i class="icon-chevron-right"></i>
        Información del proyecto</a>
                  </li>
                                                                                                                                                                                                                                                        
      <li>
    
                          <a href="project-reports.html" title="Informes del proyecto">
          <i class="icon-chevron-right"></i>
        Informes del proyecto</a>
                  </li>
            </ul>
                
                    
                
          <hr class="divider" />

           <div id="poweredBy">
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                             <a href="http://maven.apache.org/" title="Generado por Maven" class="poweredBy">
        <img class="builtBy" alt="Generado por Maven" src="./images/logos/maven-feather.png" />
      </a>
                  </div>
          </div>
        </div>
        
                
        <div id="bodyColumn"  class="span9" >
                                  
            <!-- Copyright 2010-2012 The MyBatis Team

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License. --><!-- version: $Id$ -->

  
  <div class="section"><h2>Statement Builders<a name="Statement_Builders"></a></h2>
  <div class="section"><h3>SelectBuilder<a name="SelectBuilder"></a></h3>
  <p>Una de las cosas m&#xe1;s tediosas que un programador Java puede llegar a tener que hacer es incluir c&#xf3;digo SQL en c&#xf3;digo Java. Normalmente esto se hace cuando es necesario generar din&#xe1;micamente el SQL &#x2013; de otra forma podr&#xed;as externalizar el c&#xf3;digo en un fichero o un procedimiento almacenado. Como ya has visto, MyBatis tiene una respuesta potente a la generaci&#xf3;n din&#xe1;mica de SQL mediante las capacidades del mapeo XML. Sin embargo, en ocasiones se hace necesario construir una sentencia SQL dentro del c&#xf3;digo Java. En este caso, MyBatis tiene una funcionalidad m&#xe1;s para ayudarte en ello, antes de que comiences con el t&#xed;pico l&#xed;o de signos de suma, comillas, l&#xed;neas nuevas, problemas de formato y condicionales anidados para tratar con las comas extra y las conjunciones AND&#x2026; Realmente, generar c&#xf3;digo din&#xe1;mico en java, puede ser una verdadera pesadilla.</p>
  <p>MyBatis 3 introduce un concepto un tanto distinto para tratar con el problema. Podr&#xed;amos haber creado simplemente una clase que te permitiera invocar a m&#xe9;todos para crear una sentencia SQL paso a paso. En su lugar hemos intentado proporcionar algo distinto. El resultado est&#xe1; m&#xe1;s pr&#xf3;ximo a un Domain Specific Languaje de lo que java jam&#xe1;s estar&#xe1; en su estado actual&#x2026;</p>
  <p><b>Los secretos de SelectBuilder</b></p>
  <p>La clase SelectBuilder no es m&#xe1;gica, y tampoco pasa nada si no sabes c&#xf3;mo funciona internamente. As&#xed; que veamos sin m&#xe1;s pre&#xe1;mbulo qu&#xe9; es lo que hace. SelectBuilder usa una combinaci&#xf3;n de imports est&#xe1;ticos y una variable ThreadLocal para permitir una sintaxis m&#xe1;s limpia que permite entrelazar condicionales y se encarga del formateo de SQL por ti. Te permite crear m&#xe9;todos como este:</p>
<div class="source"><pre class="prettyprint">public String selectBlogsSql() {
  BEGIN(); // Clears ThreadLocal variable
  SELECT(&quot;*&quot;);
  FROM(&quot;BLOG&quot;);
  return SQL();
}</pre></div>  
    <p>Este es un ejemplo bastante sencillo que posiblemente habr&#xed;as preferido construir en est&#xe1;tico. Aqu&#xed; hay uno m&#xe1;s complicado:</p>
<div class="source"><pre class="prettyprint">private String selectPersonSql() {
  BEGIN(); // Clears ThreadLocal variable
  SELECT(&quot;P.ID, P.USERNAME, P.PASSWORD, P.FULL_NAME&quot;);
  SELECT(&quot;P.LAST_NAME, P.CREATED_ON, P.UPDATED_ON&quot;);
  FROM(&quot;PERSON P&quot;);
  FROM(&quot;ACCOUNT A&quot;);
  INNER_JOIN(&quot;DEPARTMENT D on D.ID = P.DEPARTMENT_ID&quot;);
  INNER_JOIN(&quot;COMPANY C on D.COMPANY_ID = C.ID&quot;);
  WHERE(&quot;P.ID = A.ID&quot;);
  WHERE(&quot;P.FIRST_NAME like ?&quot;);
  OR();
  WHERE(&quot;P.LAST_NAME like ?&quot;);
  GROUP_BY(&quot;P.ID&quot;);
  HAVING(&quot;P.LAST_NAME like ?&quot;);
  OR();
  HAVING(&quot;P.FIRST_NAME like ?&quot;);
  ORDER_BY(&quot;P.ID&quot;);
  ORDER_BY(&quot;P.FULL_NAME&quot;);
  return SQL();
}</pre></div>  
    <p>Construir el SQL de arriba concatenando Strings ser&#xed;a complicado. Por ejemplo:</p>
<div class="source"><pre class="prettyprint">&quot;SELECT P.ID, P.USERNAME, P.PASSWORD, P.FULL_NAME, &quot;
&quot;P.LAST_NAME,P.CREATED_ON, P.UPDATED_ON &quot; +
&quot;FROM PERSON P, ACCOUNT A &quot; +
&quot;INNER JOIN DEPARTMENT D on D.ID = P.DEPARTMENT_ID &quot; +
&quot;INNER JOIN COMPANY C on D.COMPANY_ID = C.ID &quot; +
&quot;WHERE (P.ID = A.ID AND P.FIRST_NAME like ?) &quot; +
&quot;OR (P.LAST_NAME like ?) &quot; +
&quot;GROUP BY P.ID &quot; +
&quot;HAVING (P.LAST_NAME like ?) &quot; +
&quot;OR (P.FIRST_NAME like ?) &quot; +
&quot;ORDER BY P.ID, P.FULL_NAME&quot;;</pre></div>  
    <p>Si prefieres esa sintaxis, no hay problema en que la uses. Sin embargo, es bastante propensa a errores. F&#xed;jate la cuidadosa adici&#xf3;n de un espacio en blanco al final de cada l&#xed;nea. Aun as&#xed;, incluso si prefieres esta sintaxis, el siguiente ejemplo es decididamente m&#xe1;s sencillo que la concatenaci&#xf3;n de Strings:</p>
<div class="source"><pre class="prettyprint">private String selectPersonLike(Person p){
  BEGIN(); // Clears ThreadLocal variable
  SELECT(&quot;P.ID, P.USERNAME, P.PASSWORD, P.FIRST_NAME, P.LAST_NAME&quot;);
  FROM(&quot;PERSON P&quot;);
  if (p.id != null) {
  WHERE(&quot;P.ID like #{id}&quot;);
  }
  if (p.firstName != null) {
  WHERE(&quot;P.FIRST_NAME like #{firstName}&quot;);
  }
  if (p.lastName != null) {
  WHERE(&quot;P.LAST_NAME like #{lastName}&quot;);
  }
  ORDER_BY(&quot;P.LAST_NAME&quot;);
  return SQL();
}</pre></div>  
    <p>&#xbf;Qu&#xe9; hay de especial en este ejemplo? Bien, si lo miras detenidamente, ver&#xe1;s que no hay que preocuparse de duplicar &#x201c;AND&#x201d;s, o elegir entre &#x201c;WHERE&#x201d; o &#x201c;AND&#x201d;, o ninguno de ambos! La sentencia de arriba crea una &#x201c;query by example&#x201d; (query a partir de un ejemplo) para todos los registros de PERSON, algunos con un like por el par&#xe1;metro ID, otros por el par&#xe1;metro firstName o por lastName -  o cualquier combinaci&#xf3;n de ellos. La SelectBuilder se encarga de saber cu&#xe1;ndo es necesario a&#xf1;adir un &#x201c;WHERE&#x201d;, cuando debes a&#xf1;adirse un &#x201c;AND&#x201d; y tambi&#xe9;n de la concatenaci&#xf3;n de Strings. Y lo mejor de todo es que lo hace casi de forma independiente de c&#xf3;mo hayas llamado los m&#xe9;todos (la &#xfa;nica excepci&#xf3;n es el m&#xe9;todo OR()).</p>
    <p>Los dos m&#xe9;todos que puede que te hayan llamado la atenci&#xf3;n son: BEGIN() y SQL(). Simplificando, siempre debe comenzarse a usar el SelectBuilder llamado a BEGIN() y finalizar llamando a SQL(). Por supuesto puedes incluir m&#xe9;todos entre medio como lo requiera tu l&#xf3;gica pero el &#xe1;mbito de la generaci&#xf3;n siempre comienza con un BEGIN() y acaba con un SQL(). El m&#xe9;todo BEGIN() limpia la variable  ThreadLocal, para asegurar que no arrastras informaci&#xf3;n de un estado anterior, y el m&#xe9;todo SQL() ensambla la sentencia SQL bas&#xe1;ndose en las llamadas que has ido haciendo desde la &#xfa;ltima llamada a BEGIN(). Debes saber que BEGIN() tiene un sin&#xf3;nimo llamado RESET() que hace exactamente lo mismo pero se lee mejor en ciertos contextos.</p>
    <p>Para usar el SelectBuilder como en los ejemplos de arriba simplemente tienes que importarlo est&#xe1;ticamente de la siguiente forma:</p>
<div class="source"><pre class="prettyprint">import static org.apache.ibatis.jdbc.SelectBuilder.*;</pre></div>
    <p>Una vez que se ha importado, la clase en la que est&#xe9;s trabajando tendr&#xe1; accesibles todos los m&#xe9;todos del SelectBuilder. La lista completa de m&#xe9;todos es la siguiente:</p>
    <table border="0" class="table table-striped">
    <thead>
    <tr class="a"><th><p>Method</p></th><th><p>Description</p></th></tr></thead>
    <tbody>
  <tr class="b">
    <td>
      <tt>BEGIN()</tt> / <tt>RESET()</tt>
    </td>
    <td>Estos m&#xe9;todos limpian estado guardad en el ThreadLocal de la clase SelectBuilder, y la preparan para construir una nueva sentencia. BEGIN() se lee mejor cuando se est&#xe1; creando una sentencia. RESET() se lee mejor cuando se est&#xe1; borrando lo hecho anteriormente en medio de una ejecuci&#xf3;n (quiz&#xe1; porque la l&#xf3;gica necesita una sentencia completamente distinta seg&#xfa;n las condiciones).</td>
  </tr>
  <tr class="a">
    <td>
      <tt>SELECT(String)</tt>
    </td>
    <td>Comienza o a&#xf1;ade a una sentencia SELECT. Se puede invocar m&#xe1;s de una vez y los par&#xe1;metros se ir&#xe1;n a&#xf1;adiendo a la sentencia SELECT. Los par&#xe1;metros son normalmente una lista de columnas o alias separados por comas, pero puede ser cualquier cosa que acepte el driver de base de datos.</td>
  </tr>
  <tr class="b">
    <td>
      <tt>SELECT_DISTINCT(String)</tt>
    </td>
    <td>Comienza o a&#xf1;ade a una sentencia SELECT, tambi&#xe9;n a&#xf1;ade la palabra clave &#x201c;DISTINCT&#x201d; a la sentencia generada. Se puede invocar m&#xe1;s de una vez y los par&#xe1;metros se ir&#xe1;n a&#xf1;adiendo a la sentencia SELECT. Los par&#xe1;metros son normalmente una lista de columnas o alias separados por comas, pero puede ser cualquier cosa que acepte el driver de base de datos.</td>
  </tr>
  <tr class="a">
    <td>
      <tt>FROM(String)</tt>
    </td>
    <td>Comienza o a&#xf1;ade a una cl&#xe1;usula FROM. Se puede invocar m&#xe1;s de una vez y los par&#xe1;metros se ir&#xe1;n a&#xf1;adiendo a la clausula FROM. Los par&#xe1;metros son normalmente un nombre de tabla o alias o cualquier cosa que acepte el driver de base de datos.</td>
  </tr>
  <tr class="b">
    <td>
      <ul>
        <li><tt>JOIN(String)</tt></li>
        <li><tt>INNER_JOIN(String)</tt></li>
        <li><tt>LEFT_OUTER_JOIN(String)</tt></li>
        <li><tt>RIGHT_OUTER_JOIN(String)</tt></li>
      </ul>
    </td>
    <td>A&#xf1;ade una nueva clausula JOIN del tipo apropiado, dependiendo al m&#xe9;todo que se haya llamado. El par&#xe1;metro puede incluir un join est&#xe1;ndar que consiste en las columnas y las condiciones sobre las que hacer la join.</td>
  </tr>
  <tr class="a">
    <td>
      <tt>WHERE(String)</tt>
    </td>
    <td>A&#xf1;ade una nueva condici&#xf3;n a la clausula WHERE concatenada con un AND. Puede llamarse m&#xe1;s de una vez, lo cual har&#xe1; que se a&#xf1;adan m&#xe1;s condiciones todas ellas concatenadas con un AND. O usa OR() para partirlas con un OR().</td>
  </tr>
  <tr class="b">
    <td>
      <tt>OR()</tt>
    </td>
    <td>Parte las condiciones actuales de la WHERE con un OR. Puede llamarse m&#xe1;s de una vez, pero llamarlas m&#xe1;s de una vez en la misma l&#xed;nea puede producir sentencias incorrectas.</td>
  </tr>
  <tr class="a">
    <td>
      <tt>AND()</tt>
    </td>
    <td>Parte las condiciones actuales de la WHERE con un AND. Puede llamarse m&#xe1;s de una vez, pero llamarlas m&#xe1;s de una vez en la misma l&#xed;nea puede producir sentencias incorrectas.  Dado que WHERE y HAVING concatenan autom&#xe1;ticamente el AND, es muy infrecuente que sea necesario invocar a este m&#xe9;todo y se incluye realmente por completitud.</td>
  </tr>
  <tr class="b">
    <td>
      <tt>GROUP_BY(String)</tt>
    </td>
    <td>A&#xf1;ade una nueva clausula GROUP BY grupo, concatenada con una coma. Se le puede llamar m&#xe1;s de una vez, lo cual har&#xe1; que se concatenen nuevas condiciones separadas tambi&#xe9;n por coma.</td>
  </tr>
  <tr class="a">
    <td>
      <tt>HAVING(String)</tt>
    </td>
    <td>A&#xf1;ade una nueva clausula HAVING, concatenada con un AND. Se le puede llamar m&#xe1;s de una vez, lo cual har&#xe1; que se concatenen nuevas condiciones separadas tambi&#xe9;n por AND. Usa OR() para dividirlas por OR.</td>
  </tr>
  <tr class="b">
    <td>
      <tt>ORDER_BY(String)</tt>
    </td>
    <td>A&#xf1;ade un Nuevo elemento a la clausula ORDER BY concatenado por coma. Se le puede llamar m&#xe1;s de una vez, lo cual har&#xe1; que se concatenen nuevas condiciones separadas tambi&#xe9;n por coma.</td>
  </tr>
  <tr class="a">
    <td>
      <tt>SQL()</tt>
    </td>
    <td>Devuelve la SQL generada y restablece el estado del SelectBuilder (como si se hubiera llamado a un BEGIN() o a un RESET()). Por tanto este m&#xe9;todo solo se puede llamar una vez!</td>
  </tr>
    </tbody></table>
    </div>

    <div class="section"><h3>SqlBuilder<a name="SqlBuilder"></a></h3>
    <p>De forma similar a la SelectBuilder, MyBatis tambi&#xe9;n proporciona una SqlBuilder generalizada. Incluye los m&#xe9;todos de SelectBuilder y tambi&#xe9;n m&#xe9;todos para crear inserts, updates y deletes. Esta clase puede ser de utilidad para usarla en la creaci&#xf3;n de SQLs en DeleteProvider, InsertProvider o UpdateProvider (y tambi&#xe9;n la SelectProvider)</p>
    <p>Para usar el SqlBuilder como en los ejemplos de arriba simplemente tienes que importarlo est&#xe1;ticamente de la siguiente forma:</p>
    <div class="source"><pre class="prettyprint">import static org.apache.ibatis.jdbc.SqlBuilder.*;</pre></div>
    <p>SqlBuilder contiene todos los m&#xe9;todos de SelectBuilder, y estos m&#xe9;todos adicionales:</p>
      <table border="0" class="table table-striped">
      <thead>
      <tr class="a"><th>Metodo</th><th>Descripci&#xf3;n</th></tr>
      </thead>
      <tbody>
      <tr class="b">
  <td>
    <tt>DELETE_FROM(String)</tt>
  </td>
  <td>Comienza una sentencia delete y especifica la tabla donde borrar. Generalmente suele ir seguida de una clausula WHERE!
  </td>
</tr>
  <tr class="a">
    <td>
      <tt>INSERT_INTO(String)</tt>
    </td>
    <td>Comienza una sentencia insert y especifica al tabla en la que insertar. Suele ir seguida de una o m&#xe1;s llamadas a VALUES().
    </td>
  </tr>
  <tr class="b">
    <td>
      <tt>SET(String)</tt>
    </td>
    <td>A&#xf1;ade a la lista &#x201c;set&#x201d; de una update.</td>
  </tr>
  <tr class="a">
    <td>
      <tt>UPDATE(String)</tt>
    </td>
    <td>Comienza una sentencia update y especifica la tabla que modificar Suele ir seguida de una o m&#xe1;s llamadas a SET() y normalmente de una llamada a WHERE().</td>
  </tr>
  <tr class="b">
    <td>
      <tt>VALUES(String, String)</tt>
    </td>
    <td>A&#xf1;ade a una sentencia insert. El primer par&#xe1;metro es el nombre de columna y el Segundo el valor(es).</td>
  </tr>
      </tbody>
    </table>

    <p>Aqu&#xed; hay algunos ejemplos:</p>

<div class="source"><pre class="prettyprint">public String deletePersonSql() {
  BEGIN(); // Clears ThreadLocal variable
  DELETE_FROM(&quot;PERSON&quot;);
  WHERE(&quot;ID = ${id}&quot;);
  return SQL();
}

public String insertPersonSql() {
  BEGIN(); // Clears ThreadLocal variable
  INSERT_INTO(&quot;PERSON&quot;);
  VALUES(&quot;ID, FIRST_NAME&quot;, &quot;${id}, ${firstName}&quot;);
  VALUES(&quot;LAST_NAME&quot;, &quot;${lastName}&quot;);
  return SQL();
}

public String updatePersonSql() {
  BEGIN(); // Clears ThreadLocal variable
  UPDATE(&quot;PERSON&quot;);
  SET(&quot;FIRST_NAME = ${firstName}&quot;);
  WHERE(&quot;ID = ${id}&quot;);
  return SQL();
}</pre></div>  
  </div>
  </div>
  


                  </div>
            </div>
          </div>

    <hr/>

    <footer>
            <div class="container-fluid">
              <div class="row span12">Copyright &copy;                    2010-2013
                        <a href="http://www.mybatis.org/">MyBatis.org</a>.
            All Rights Reserved.      
                    
      </div>

        
        
                </div>
    </footer>
  </body>
</html>
